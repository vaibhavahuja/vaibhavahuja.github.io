<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>How I secured CWC'23 tickets by exploiting flaws in BookMyShow - Vaibhav Ahuja</title>
  <meta name="description" content="my personal space where i write about stuff that excites me.">
  <link rel="stylesheet" href="http://localhost:4000/css/main.css">
  <link rel="canonical" href="http://localhost:4000/how-i-got-every-wc-ticket">
  <link rel="alternate" type="application/rss+xml" title="Vaibhav Ahuja" href="http://localhost:4000/feed.xml">
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2WNHZ5BJ2N"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-2WNHZ5BJ2N');
</script>
</head>

  <body>
    <div class="page-content">
      <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">How I secured CWC'23 tickets by exploiting flaws in BookMyShow</h1>
    <p class="post-meta">
      <time datetime="2022-01-12T16:51:29+05:30" itemprop="datePublished">Jan 12, 2022</time>
      

      
  		

  		
  		

  		&middot;	<span class="tags" itemprop="tags">
  				<a href="http://localhost:4000/tagged#strategy">#strategy</a>
  			</span>

  	  

    </p>
  </header>
  <div class="post-content" itemprop="articleBody">
    <h3 id="context">Context</h3>

<p>India is a cricket crazy country. No sport is celebrated as cricket is here. With this star studded team under the guidance of Jay Shah, we were all set to win the WC’23 but then australia happened.</p>

<p><img src="../images/indvsaus.jpeg" alt="" /></p>

<p>With India hosting the world cup, the demand for the tickets (for India matches) was unbelieveable, the whole country wanted to support the team in the stadium, and why not? BCCI decided to give <a href="https://in.bookmyshow.com/">BookMyShow</a> the rights to be the sole ticket distributor, and I am glad they did. Any ticket purchased for the world cup, was to be purchased on the online platform of BookMyShow. The thing is, that the seats are limited and there is no limit to the number of people who want their hands on the tickets.</p>

<p>A quick overview of how the sale for india matches happened.</p>

<h4 id="sample-timeline-of-the-ticket-booking-process">Sample Timeline of the ticket booking process</h4>

<ol>
  <li><strong>[A day before sale day]</strong>
BCCI announces on Twitter/News about the sale for the ticket. (say e.g “India vs Pakistan tickets to be out on 8pm on dd/mm/yyyy on BookMyShow”)</li>
  <li><strong>[7:58PM]</strong>
All the cricket fans, are ready with their laptops , bombarding the bookMyShow systems to book the tickets.</li>
  <li><strong>[8.00PM]</strong> 
BookMyShow adds the fans to a queue to book the tickets</li>
  <li><strong>[8.55PM]</strong> 
99% fans leave the queue with a message “The tickets are SOLD OUT!”
If lucky, and you get in the queue, you are free to book the tickets.</li>
</ol>

<h4 id="issues">Issues</h4>

<ul>
  <li>No transparency with the system. No one has idea about how many tickets are being released on DAY x.</li>
  <li>With almost everyone trying to get in the system at 8.00PM, who is able to pass the queue and who is not, depends highly on the luck of the individual.</li>
  <li>My luck isn’t that great, so when I tried to get in the queue for Ind VS Pak for the first time, all the tickets were sold out, and I could not get the tickets.</li>
</ul>

<p>Although I was unable to get the tickets, I somehow managed to get my hands on the API which has seat information, and I was shocked to see how little tickets BMS is releasing. Now agreed, BMS is just a platform and the ticket seller can control, but transparency is something a buyer would expect. They just released 8-9k seats in a stadium with total capacity of 132k.
There was very little chances that I could get the tickets this way, so I tried to think in other directions.</p>

<blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/hashtag/BookMyShowScam?src=hash&amp;ref_src=twsrc%5Etfw">#BookMyShowScam</a> <a href="https://twitter.com/hashtag/Bookmyshow?src=hash&amp;ref_src=twsrc%5Etfw">#Bookmyshow</a> <a href="https://twitter.com/ICC?ref_src=twsrc%5Etfw">@ICC</a> <a href="https://twitter.com/BCCI?ref_src=twsrc%5Etfw">@BCCI</a> <br />what is this? <a href="https://twitter.com/bookmyshow?ref_src=twsrc%5Etfw">@bookmyshow</a> <a href="https://twitter.com/narendramodi?ref_src=twsrc%5Etfw">@narendramodi</a> stadium has a total capacity of 132k <br /><br />number of seats you put on sale &lt; 10k for which millions of people are trying<br /><br />are all the other seats reserver for corporates? what about the tax payer? <a href="https://t.co/6KYanGrDQx">pic.twitter.com/6KYanGrDQx</a></p>&mdash; Vaibhav Ahuja (@vaibhav_ahuja7) <a href="https://twitter.com/vaibhav_ahuja7/status/1698348472377000291?ref_src=twsrc%5Etfw">September 3, 2023</a></blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<!-- ![CWC Tweet](../images/cwcTweet.png) -->

<h3 id="my-thought-process">My Thought process</h3>

<ul>
  <li>BookMyShow has a queue based system, and they add people in the queue on the basis of time they enter the queue.</li>
  <li>At exactly 8, system is bombarded with requests. System must be experiencing atleast 15-20M RPM, and pre scaling must be done. What is pre scaling? <em>Before experiencing high loads, systems are already scaled, so it does not take time for scaling when the demand increases and requests are not throttled.</em> Also the API must be public before 8. They cannot keep the API private until 8.</li>
  <li>The queue system must have an API exposed, something like this, which is already scaled :</li>
</ul>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="n">addToQueue</span><span class="p">(</span><span class="n">userId</span> <span class="n">int64</span><span class="p">,</span> <span class="n">currentTime</span> <span class="n">time</span><span class="p">.</span><span class="n">Time</span><span class="p">,</span> <span class="n">details</span> <span class="n">MatchDetails</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//adds the user to queue at time [currentTime] for match [details]</span>
<span class="p">}</span></code></pre></figure>

<ul>
  <li>Since the system is exposed 5-10 minutes before the time, all we needed to do, was figure out a way how to hit the API before 8pm, to get an edge over the other people trying to get inside the queue at 8.00PM.</li>
</ul>

<h4 id="figuring-out-the-queue-url">Figuring out the Queue URL</h4>

<ul>
  <li>After a few unsuccessful attempts in booking the tickets, I figured out that every queue URL (from where you enter the queue) has a well defined pattern.
    <h5 id="pattern-for-the-url">Pattern for the URL</h5>
  </li>
</ul>

<p>While going through the URLs for the past matches, I saw the URL looked like this.
<code class="language-plaintext highlighter-rouge">{baseUrl}/sports/&lt;match_name&gt;/seat-layout/aerialcanvas/&lt;matchId&gt;/&lt;stadiumCode&gt;/&lt;matchCode&gt;</code></p>

<ul>
  <li>Basically, for entering in a queue, we just needed the above parameters.</li>
  <li>It was easy to figure out the other parameters, but <code class="language-plaintext highlighter-rouge">matchCode</code> was a random 6 digit numeric code.</li>
  <li>I saw a few matches and realised that the <code class="language-plaintext highlighter-rouge">matchCode</code> is between 10000 and 10200, so a simple brute force would help in cracking the URL. I quickly wrote a shell script to brute force the urls and return the one which we need. Here is the script :</li>
</ul>

<script src="https://gist.github.com/vaibhavahuja/1fd19d1ff8fefbacb48c6d4b3fc9fcfe.js"></script>

<p>That is it, with this script I managed to get the urls for every match before hand, and used it to get in the queue at 7:55PM. This gave me an edge of around 5 minutes, over anyone else. Since the majority logged in at 8, I was put in queue ahead of them, and was able to book the tickets without any hassle.</p>

<h3 id="fetching-the-real-time-seat-information">Fetching the Real Time Seat Information</h3>

<p>I was able to scrape the API for fetching the tickets, and I saw a lot of tweets regarding the same, cursing BMS for releasing a small number of tickets. Seems, bookMyShow decided to encrypt the response now. But, it was easy to decrypt, because maybe the bms devs did not realise that the client would in the end have to decrypt the response. It really did not make any sense to send an encrypted response to the client.</p>

<p>Sample cURL for fetching seat info</p>

<p><code class="language-plaintext highlighter-rouge">curl 'https://in.bookmyshow.com/api/le/seatLayout/showinfo?venueCode=KSCA&amp;sessionID=10057&amp;eventCode=ET00367591' \
  -H 'user-agent: Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Mobile Safari/537.36' \
  -H 'x-bms-le-app-code: WEB' \
  --compressed</code></p>

<p>Response -&gt; <a href="https://jsonblob.com/1179043777594908672">JSON BLOB RESPONSE</a></p>

<p>Since this data was encrypted, I started fiddling with the client code to figure out how they decrypted it and came across this method.
<a href="https://gist.github.com/vaibhavahuja/02648eb7fb30d33478929971591d21e9">Here</a> is the full file if anyone is interested.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">a</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">a</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Base64</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
              <span class="p">,</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">a</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Utf8</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="dl">"</span><span class="s2">yW8YubOEm5DhPlvy0MDOM0RljolbjisR</span><span class="dl">"</span><span class="p">)</span>
              <span class="p">,</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">a</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Utf8</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="dl">"</span><span class="s2">yW8YubOEm5DhPlvy</span><span class="dl">"</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">o</span><span class="p">.</span><span class="nx">a</span><span class="p">.</span><span class="nx">AES</span><span class="p">.</span><span class="nx">decrypt</span><span class="p">({</span>
                <span class="na">ciphertext</span><span class="p">:</span> <span class="nx">t</span>
            <span class="p">},</span> <span class="nx">n</span><span class="p">,</span> <span class="p">{</span>
                <span class="na">mode</span><span class="p">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">a</span><span class="p">.</span><span class="nx">mode</span><span class="p">.</span><span class="nx">CBC</span><span class="p">,</span>
                <span class="na">iv</span><span class="p">:</span> <span class="nx">r</span>
            <span class="p">}).</span><span class="nx">toString</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">a</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Utf8</span><span class="p">)</span>
        <span class="p">}</span></code></pre></figure>

<p>They had encrypted the response using <code class="language-plaintext highlighter-rouge">AES</code>, with Cipher Mode as <code class="language-plaintext highlighter-rouge">CBC</code> and the key size as <code class="language-plaintext highlighter-rouge">256 bits</code>. It really does not make sense to decrypt at client!!</p>

<p>Decrypted the response with some <a href="https://www.devglan.com/online-tools/aes-encryption-decryption">online decryption tool</a> and got a base64 encoded response, which on decoding, you get the actual response.</p>

<p>Response attached <a href="http://jsonblob.com/1179045408126394368">here</a>.</p>

<h3 id="conclusion">Conclusion</h3>

<ul>
  <li>BMS should have enhanced the security tbh. By generating a new url per user (using some hmac or something) things would have been extremely hard for anyone to get inside the queue before the designated time. Or even better, BCCI could have started some lucky draw process to get the tickets.</li>
  <li>BCCI should have been more transparent. CWC tickets should be released with a defined process, and transparency on how many tickets are being released and when, would have been amazing.</li>
  <li>E-Tickets would have been amazing. The way ticketing was organised in fifa’22 was something else.</li>
  <li>India shouldn’t have taken Surya Kumar Yadav with them. He did not perform in a single match, and when the team needed him the most (in the finals), he gave strike to the tailenders and preferred to stand on the runners end. Just terrible.</li>
</ul>

<p><img src="../images/jayShahCricket.jpeg" alt="JayShah" /></p>

  </div>
  <hr>
  
    
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname  = 'https-vaibhavahuja-github-io-1';
    var disqus_identifier = '/how-i-got-every-wc-ticket';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>


  
</article>

      <div class="copyright">
      <p> Powered by <a href="https://jekyllrb.com/">Jekyll</a> </p>
      </div>
    </div>
    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'G-2WNHZ5BJ2N', 'auto');
  ga('send', 'pageview');
</script>




  </body>
</html>
